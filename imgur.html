<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Strictly Non-Overlapping Imgur Gallery</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background: #222;
            text-align: center;
        }
        h1 {
            color: white;
            margin-bottom: 10px;
        }
        button {
            background-color: #85BF25;
            color: white;
            border: none;
            padding: 12px 24px;
            font-size: 16px;
            cursor: pointer;
            border-radius: 4px;
            margin: 10px 0;
            transition: all 0.3s;
        }
        button:hover { background-color: #6EA520; }
        button:disabled {
            background-color: #444;
            cursor: not-allowed;
        }
        #gallery {
            margin: 20px auto;
            width: 90vw;
            display: flex;
            flex-wrap: wrap;
        }
        .gallery-item {
            flex-grow: 1;
            min-width: 200px;
            height: 200px;
            overflow: hidden;
            position: relative;
        }
        .gallery-image {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform 0.3s;
        }
        .gallery-item:hover .gallery-image {
            transform: scale(1.05);
            z-index: 2;
        }
        #loading {
            display: none;
            margin: 20px 0;
            font-size: 18px;
            color: white;
        }
        #stats {
            margin: 15px 0;
            font-size: 14px;
            color: #aaa;
            position: sticky;
            top: 0;
            background: rgba(34,34,34,0.9);
            padding: 10px;
            z-index: 100;
            backdrop-filter: blur(5px);
        }
        .progress-container {
            width: 80%;
            max-width: 500px;
            margin: 10px auto;
            height: 10px;
            background: #444;
            border-radius: 5px;
            overflow: hidden;
        }
        .progress-bar {
            height: 100%;
            background: #85BF25;
            width: 0%;
            transition: width 0.3s;
        }
    </style>
</head>
<body>
    <h1>Strictly Non-Overlapping Gallery</h1>
    <p>Zero gaps, no overlap, edge-to-edge images</p>
    
    <button id="generate-btn">Load 100 Images</button>
    <div id="stats">
        Images loaded: <span id="found-count">0</span>/100 | 
        Attempts: <span id="attempt-count">0</span>
    </div>
    <div class="progress-container">
        <div class="progress-bar" id="progress-bar"></div>
    </div>
    
    <div id="loading">Calculating perfect layout...</div>
    
    <div id="gallery"></div>

    <script>
        const generateBtn = document.getElementById('generate-btn');
        const gallery = document.getElementById('gallery');
        const loadingElement = document.getElementById('loading');
        const foundCountElement = document.getElementById('found-count');
        const attemptCountElement = document.getElementById('attempt-count');
        const progressBar = document.getElementById('progress-bar');
        
        const TARGET_COUNT = 100;
        const MAX_ATTEMPTS = 1000;
        const CONCURRENT_CHECKS = 20;
        const RETRY_DELAY = 50;
        const BASE_CELL_SIZE = 200; // px
        
        let attempts = 0;
        let foundImages = 0;
        let isSearching = false;
        const PLACEHOLDER_DIMENSIONS = [
            {width: 161, height: 81}, {width: 1, height: 1}, {width: 130, height: 100}
        ];

        generateBtn.addEventListener('click', generateGallery);

        function generateGallery() {
            if (isSearching) return;
            
            isSearching = true;
            attempts = 0;
            foundImages = 0;
            updateUI();
            generateBtn.disabled = true;
            loadingElement.style.display = 'block';
            gallery.innerHTML = '';
            
            for (let i = 0; i < CONCURRENT_CHECKS; i++) {
                tryNextImage();
            }
        }

        function updateUI() {
            foundCountElement.textContent = foundImages;
            attemptCountElement.textContent = attempts;
            progressBar.style.width = `${(foundImages/TARGET_COUNT)*100}%`;
            
            if (attempts > MAX_ATTEMPTS * 0.8) {
                attemptCountElement.style.color = '#ff9900';
            }
        }

        function tryNextImage() {
            if (!isSearching || foundImages >= TARGET_COUNT || attempts >= MAX_ATTEMPTS) {
                if (foundImages >= TARGET_COUNT || attempts >= MAX_ATTEMPTS) {
                    finishSearch();
                }
                return;
            }
            
            attempts++;
            updateUI();
            
            const randomId = generateRandomId();
            const extensions = ['.jpg', '.jpeg', '.png', '.gif'];
            const randomExt = extensions[Math.floor(Math.random() * extensions.length)];
            const imgurUrl = `https://i.imgur.com/${randomId}${randomExt}`;
            
            verifyAndAddImage(imgurUrl);
        }

        function generateRandomId() {
            const chars = 'abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789';
            const length = 5 + Math.floor(Math.random() * 3);
            return Array.from({length}, () => chars[Math.floor(Math.random() * chars.length)]).join('');
        }

        function verifyAndAddImage(url) {
            const img = new Image();
            
            img.onload = function() {
                const isPlaceholder = PLACEHOLDER_DIMENSIONS.some(
                    dim => this.width === dim.width && this.height === dim.height
                );
                
                if (!isPlaceholder && this.width > 10 && this.height > 10) {
                    addImageToGallery(url, this.width, this.height);
                    foundImages++;
                    updateUI();
                    
                    if (foundImages < TARGET_COUNT) {
                        setTimeout(tryNextImage, 0);
                    } else {
                        finishSearch();
                    }
                } else {
                    setTimeout(tryNextImage, RETRY_DELAY);
                }
            };
            
            img.onerror = function() {
                setTimeout(tryNextImage, RETRY_DELAY);
            };
            
            img.src = url;
        }

        function addImageToGallery(url, originalWidth, originalHeight) {
            const item = document.createElement('div');
            item.className = 'gallery-item';
            
            // Calculate size while maintaining aspect ratio
            const aspectRatio = originalWidth / originalHeight;
            item.style.flexBasis = `${BASE_CELL_SIZE * Math.min(2, aspectRatio)}px`;
            item.style.height = `${BASE_CELL_SIZE}px`;
            
            const img = document.createElement('img');
            img.className = 'gallery-image';
            img.src = url;
            img.alt = 'Imgur image';
            img.loading = 'lazy';
            
            item.appendChild(img);
            gallery.appendChild(item);
        }

        function finishSearch() {
            isSearching = false;
            generateBtn.disabled = false;
            loadingElement.style.display = 'none';
            
            if (foundImages < TARGET_COUNT) {
                const message = document.createElement('div');
                message.style.width = '100%';
                message.style.color = attempts >= MAX_ATTEMPTS ? '#ff4444' : '#ff9900';
                message.textContent = attempts >= MAX_ATTEMPTS 
                    ? `Reached maximum attempts (${MAX_ATTEMPTS})` 
                    : `Only found ${foundImages} valid images`;
                gallery.appendChild(message);
            }
        }
    </script>
</body>
</html>
