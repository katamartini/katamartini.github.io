<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Imgur Image Grid Finder</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            text-align: center;
        }
        button {
            background-color: #85BF25;
            color: white;
            border: none;
            padding: 12px 24px;
            font-size: 16px;
            cursor: pointer;
            border-radius: 4px;
            margin: 20px 0;
            transition: all 0.3s;
        }
        button:hover { background-color: #6EA520; }
        button:disabled {
            background-color: #cccccc;
            cursor: not-allowed;
        }
        #image-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }
        .image-card {
            border: 1px solid #ddd;
            border-radius: 5px;
            padding: 10px;
            background: #f9f9f9;
            transition: transform 0.2s;
        }
        .image-card:hover {
            transform: scale(1.03);
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        .image-preview {
            width: 100%;
            height: 160px;
            object-fit: cover;
            border-radius: 3px;
        }
        .image-link {
            display: block;
            margin-top: 8px;
            font-size: 12px;
            word-break: break-all;
            color: #555;
            text-decoration: none;
        }
        .image-link:hover { text-decoration: underline; }
        .loading {
            display: none;
            margin: 20px 0;
            font-size: 18px;
        }
        #stats {
            margin: 15px 0;
            font-size: 14px;
            color: #666;
        }
        .success { color: #85BF25; }
        .error { color: #ff4444; }
        .warning { color: #ff9900; }
        .progress-bar {
            width: 100%;
            height: 10px;
            background: #eee;
            border-radius: 5px;
            margin: 10px 0;
            overflow: hidden;
        }
        .progress {
            height: 100%;
            background: #85BF25;
            width: 0%;
            transition: width 0.3s;
        }
    </style>
</head>
<body>
    <h1>Imgur Image Grid Finder</h1>
    <p>Finds 20 random non-placeholder Imgur images at once</p>
    
    <button id="generate-btn">Generate 20 Random Images</button>
    <div id="stats">
        Attempts: <span id="attempt-count">0</span> | 
        Found: <span id="found-count">0</span>/20
    </div>
    <div class="progress-bar">
        <div class="progress" id="progress-bar"></div>
    </div>
    
    <div class="loading" id="loading">
        <p>Searching for valid images...</p>
    </div>
    
    <div id="image-grid"></div>

    <script>
        const generateBtn = document.getElementById('generate-btn');
        const imageGrid = document.getElementById('image-grid');
        const loadingElement = document.getElementById('loading');
        const attemptCountElement = document.getElementById('attempt-count');
        const foundCountElement = document.getElementById('found-count');
        const progressBar = document.getElementById('progress-bar');
        
        let attempts = 0;
        let foundImages = 0;
        let isSearching = false;
        const TARGET_COUNT = 20;
        const MAX_ATTEMPTS = 500; // Safety limit
        const CONCURRENT_CHECKS = 10; // How many images to check at once

        // Known Imgur placeholder dimensions
        const PLACEHOLDER_DIMENSIONS = [
            {width: 161, height: 81},  // Standard "removed" image
            {width: 1, height: 1},     // Tiny transparent pixel
            {width: 130, height: 100}  // Other common placeholder
        ];

        generateBtn.addEventListener('click', startImageSearch);

        function startImageSearch() {
            if (isSearching) return;
            
            isSearching = true;
            attempts = 0;
            foundImages = 0;
            updateCounters();
            generateBtn.disabled = true;
            loadingElement.style.display = 'block';
            imageGrid.innerHTML = '';
            
            // Start multiple concurrent image checks
            for (let i = 0; i < CONCURRENT_CHECKS; i++) {
                tryNextImage();
            }
        }

        function updateCounters() {
            attemptCountElement.textContent = attempts;
            foundCountElement.textContent = foundImages;
            progressBar.style.width = `${(foundImages/TARGET_COUNT)*100}%`;
            
            if (attempts > MAX_ATTEMPTS * 0.8) {
                attemptCountElement.className = 'warning';
            }
        }

        function tryNextImage() {
            if (!isSearching || foundImages >= TARGET_COUNT || attempts >= MAX_ATTEMPTS) {
                if (foundImages >= TARGET_COUNT || attempts >= MAX_ATTEMPTS) {
                    finishSearch();
                }
                return;
            }
            
            attempts++;
            updateCounters();
            
            // Generate random Imgur ID (5-7 chars)
            const randomId = generateRandomId();
            const extensions = ['.jpg', '.jpeg', '.png', '.gif'];
            const randomExt = extensions[Math.floor(Math.random() * extensions.length)];
            const imgurUrl = `https://i.imgur.com/${randomId}${randomExt}`;
            
            verifyImage(imgurUrl);
        }

        function generateRandomId() {
            const chars = 'abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789';
            const length = 5 + Math.floor(Math.random() * 3);
            return Array.from({length}, () => chars[Math.floor(Math.random() * chars.length)]).join('');
        }

        function verifyImage(url) {
            const img = new Image();
            
            img.onload = function() {
                const isPlaceholder = PLACEHOLDER_DIMENSIONS.some(
                    dim => this.width === dim.width && this.height === dim.height
                );
                
                if (!isPlaceholder && this.width > 10 && this.height > 10) {
                    addImageToGrid(url, this.width, this.height);
                    foundImages++;
                    updateCounters();
                    
                    if (foundImages < TARGET_COUNT) {
                        tryNextImage();
                    } else {
                        finishSearch();
                    }
                } else {
                    setTimeout(tryNextImage, 0);
                }
            };
            
            img.onerror = function() {
                setTimeout(tryNextImage, 0);
            };
            
            img.src = url;
        }

        function addImageToGrid(url, width, height) {
            const card = document.createElement('div');
            card.className = 'image-card';
            card.innerHTML = `
                <img class="image-preview" src="${url}" alt="Imgur image" loading="lazy">
                <a href="${url}" class="image-link" target="_blank">${width}Ã—${height}</a>
            `;
            imageGrid.appendChild(card);
        }

        function finishSearch() {
            isSearching = false;
            generateBtn.disabled = false;
            loadingElement.style.display = 'none';
            
            if (foundImages < TARGET_COUNT) {
                const message = document.createElement('div');
                message.className = attempts >= MAX_ATTEMPTS ? 'error' : 'warning';
                message.textContent = attempts >= MAX_ATTEMPTS 
                    ? `Stopped after maximum attempts (${MAX_ATTEMPTS})` 
                    : `Only found ${foundImages} valid images`;
                imageGrid.appendChild(message);
            }
        }
    </script>
    
    <footer>
        <p><small>Checks image dimensions to filter out placeholders. May take many attempts to find 20 valid images.</small></p>
    </footer>
</body>
</html>
