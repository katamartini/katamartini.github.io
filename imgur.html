<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Imgur Tight-Packed Gallery</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background: #f5f5f5;
            text-align: center;
        }
        h1 {
            color: #333;
            margin-bottom: 10px;
        }
        button {
            background-color: #85BF25;
            color: white;
            border: none;
            padding: 12px 24px;
            font-size: 16px;
            cursor: pointer;
            border-radius: 4px;
            margin: 10px 0;
            transition: all 0.3s;
        }
        button:hover { background-color: #6EA520; }
        button:disabled {
            background-color: #cccccc;
            cursor: not-allowed;
        }
        #gallery {
            margin: 20px auto;
            width: 90%;
            max-width: 1200px;
            columns: 5 200px;
            column-gap: 0;
        }
        .gallery-image {
            width: 100%;
            height: auto;
            display: block;
            margin-bottom: 0;
            break-inside: avoid;
            transition: transform 0.3s;
        }
        .gallery-image:hover {
            transform: scale(1.03);
            z-index: 2;
            position: relative;
        }
        #loading {
            display: none;
            margin: 20px 0;
            font-size: 18px;
        }
        #stats {
            margin: 15px 0;
            font-size: 14px;
            color: #666;
        }
        .progress-container {
            width: 80%;
            max-width: 500px;
            margin: 10px auto;
            height: 10px;
            background: #eee;
            border-radius: 5px;
            overflow: hidden;
        }
        .progress-bar {
            height: 100%;
            background: #85BF25;
            width: 0%;
            transition: width 0.3s;
        }
        @media (max-width: 768px) {
            #gallery {
                columns: 3 150px;
            }
        }
    </style>
</head>
<body>
    <h1>Imgur Tight-Packed Gallery</h1>
    <p>Edge-to-edge display preserving original aspect ratios</p>
    
    <button id="generate-btn">Generate New Gallery</button>
    <div id="stats">
        Images found: <span id="found-count">0</span>/20
    </div>
    <div class="progress-container">
        <div class="progress-bar" id="progress-bar"></div>
    </div>
    
    <div id="loading">Building your gallery...</div>
    
    <div id="gallery"></div>

    <script>
        const generateBtn = document.getElementById('generate-btn');
        const gallery = document.getElementById('gallery');
        const loadingElement = document.getElementById('loading');
        const foundCountElement = document.getElementById('found-count');
        const progressBar = document.getElementById('progress-bar');
        
        const TARGET_COUNT = 20;
        const MAX_ATTEMPTS = 300;
        const CONCURRENT_CHECKS = 10;
        
        let attempts = 0;
        let foundImages = 0;
        let isSearching = false;
        const PLACEHOLDER_DIMENSIONS = [
            {width: 161, height: 81}, {width: 1, height: 1}, {width: 130, height: 100}
        ];

        generateBtn.addEventListener('click', generateGallery);

        function generateGallery() {
            if (isSearching) return;
            
            isSearching = true;
            attempts = 0;
            foundImages = 0;
            updateUI();
            generateBtn.disabled = true;
            loadingElement.style.display = 'block';
            gallery.innerHTML = '';
            
            for (let i = 0; i < CONCURRENT_CHECKS; i++) {
                tryNextImage();
            }
        }

        function updateUI() {
            foundCountElement.textContent = foundImages;
            progressBar.style.width = `${(foundImages/TARGET_COUNT)*100}%`;
        }

        function tryNextImage() {
            if (!isSearching || foundImages >= TARGET_COUNT || attempts >= MAX_ATTEMPTS) {
                if (foundImages >= TARGET_COUNT || attempts >= MAX_ATTEMPTS) {
                    finishSearch();
                }
                return;
            }
            
            attempts++;
            
            const randomId = generateRandomId();
            const extensions = ['.jpg', '.jpeg', '.png', '.gif'];
            const randomExt = extensions[Math.floor(Math.random() * extensions.length)];
            const imgurUrl = `https://i.imgur.com/${randomId}${randomExt}`;
            
            verifyAndAddImage(imgurUrl);
        }

        function generateRandomId() {
            const chars = 'abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789';
            const length = 5 + Math.floor(Math.random() * 3);
            return Array.from({length}, () => chars[Math.floor(Math.random() * chars.length)]).join('');
        }

        function verifyAndAddImage(url) {
            const img = new Image();
            
            img.onload = function() {
                const isPlaceholder = PLACEHOLDER_DIMENSIONS.some(
                    dim => this.width === dim.width && this.height === dim.height
                );
                
                if (!isPlaceholder && this.width > 10 && this.height > 10) {
                    addImageToGallery(url);
                    foundImages++;
                    updateUI();
                    
                    if (foundImages < TARGET_COUNT) {
                        setTimeout(tryNextImage, 0);
                    } else {
                        finishSearch();
                    }
                } else {
                    setTimeout(tryNextImage, 0);
                }
            };
            
            img.onerror = function() {
                setTimeout(tryNextImage, 0);
            };
            
            img.src = url;
        }

        function addImageToGallery(url) {
            const img = document.createElement('img');
            img.className = 'gallery-image';
            img.src = url;
            img.alt = 'Imgur image';
            img.loading = 'lazy';
            gallery.appendChild(img);
        }

        function finishSearch() {
            isSearching = false;
            generateBtn.disabled = false;
            loadingElement.style.display = 'none';
            
            if (foundImages < TARGET_COUNT) {
                const message = document.createElement('div');
                message.style.gridColumn = '1 / -1';
                message.style.color = attempts >= MAX_ATTEMPTS ? '#ff4444' : '#ff9900';
                message.textContent = attempts >= MAX_ATTEMPTS 
                    ? `Reached maximum attempts (${MAX_ATTEMPTS})` 
                    : `Found ${foundImages} images (target: ${TARGET_COUNT})`;
                gallery.appendChild(message);
            }
        }
    </script>
</body>
</html>
